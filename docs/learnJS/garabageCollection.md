---
title: js的垃圾回收机制
author: youlingyu
date: '2024-08-02'
---

有些数据被使用之后可能就不在需要了，我们把这种数据称为垃圾数据，如果这些垃圾数据一直保存在内存中，那么内存就会越用越多，所以我们需要对这些垃圾进行回收，以释放有限的内存空间。

## 标记清除法（Mark Sweep）
标记清除的原理是通过分析对象的“可达性”来决定是否回收其内存的。<br>
具体的做法是从根对象出发，开始遍历程序的整个“对象图谱”（垃圾回收器用来遍历和标记的数据结构），使用三色算法：
1. 所有对象初始化为白色，将第一次遍历到的对象标记为灰色，加入到标记栈中，然后遍历其子对象。
2. 当遍历到灰色对象时，说明循环引用，但是该对象可达，不会被清除。




## 引用计数
引用计数的原理是通过判断对象的被引用次数来决定是否回收其内存。<br>
具体过程是当初始化一个对象时，会将其引用计数标记为1，当其被引用时计数+1，取消引用时计数-1，当计数为0时，该对象就会进入待清除状态，等待后续内存回收。
<br>
引用计数会导致一个问题，那就是“无法回收循环引用对象的内存，会造成内存泄漏”，即使我们将对象设置为null，由于循环引用导致她计数永远不为0，因此内存不会被回收，造成内存泄漏。

